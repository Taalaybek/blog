<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Laravel Orchid Blog</title>
    <link href="https://blog.orchid.software/blog" />
    <link type="application/atom+xml" rel="self" href="https://blog.orchid.software/feed.atom" />
    <updated>2020-10-06T23:44:28+00:00</updated>
    <id>https://blog.orchid.software/feed.atom</id>
    <author>
        <name>Alexandr Chernyaev</name>
    </author>
                <entry>
            <id>https://blog.orchid.software/reusing-layers</id>
            <link type="text/html" rel="alternate" href="https://blog.orchid.software/reusing-layers" />
            <title>Reusing layers</title>
            <published>2020-07-01T00:00:00+00:00</published>
            <updated>2020-07-01T00:00:00+00:00</updated>
            <author>
                <name>Alexandr Chernyaev</name>
            </author>
            <summary type="html">Layouts are easy to reuse when fields are related to the relations of different models. During installation, we have a layer for defining permissions, which is used immediately at the user and roles editing screen. But sometimes you want to apply the......</summary>
            <content type="html"><![CDATA[
                <p>Layouts are easy to reuse when fields are related to the relations of different models. During installation, we have a layer for defining permissions, which is used immediately at the user and roles editing screen. But sometimes you want to apply the same set of fields with different values. Let's consider an example when you need to specify an address.</p>

<p>Such a set will be both for the client, the customer, and it will appear twice on the same form (for example, in order, delivery and invoice). To solve this situation, you do not need to create and describe almost identical layouts. Instead, let's add logic to one single layer.</p>

<pre><code class="language-php">namespace App\Orchid\Layouts;

use Orchid\Screen\Field;
use Orchid\Screen\Fields\Input;
use Orchid\Screen\Fields\Label;
use Orchid\Screen\Layouts\Rows;

class AddressLayout extends Rows
{
    /**
     * Used to create the title of a group of form elements.
     *
     * @var string|null
     */
    protected $title;

    /**
     * Prefix for a field name
     *
     * @var string
     */
    protected $prefix;

    /**
     * ReusableEditLayout constructor.
     *
     * @param string      $prefix
     * @param string|null $title
     */
    public function __construct(string $prefix, string $title = null)
    {
        $this-&gt;prefix = $prefix;
        $this-&gt;title = $title;
    }

    /**
     * Views.
     *
     * @return Field[]
     */
    protected function fields(): array
    {
        return [
            Input::make($this-&gt;prefix . '.address')
                -&gt;required()
                -&gt;title('Address')
                -&gt;placeholder('177A Bleecker Street'),
        ];
    }
}
</code></pre>

<p>Now, when used, we will pass the prefix and header values:</p>

<pre><code class="language-php">public function layout(): array
{
    return [
        Layout::columns([
            new AddressLayout('order.shipping_address', 'Shipping Address'),
            new AddressLayout('order.invoice_address', 'Invoice Address'),
        ]),
    ];
}
</code></pre>

<p>But this is also inconvenient. Why? Now in the definition, we will think, do we need to end the prefix with a dot? And also, specify strange names through the concatenation <code>$this-&gt;prefix. '.address'</code>.</p>

<p>Let's fix it! Since the main thing is to return an array of objects, you can modify the fields before returning, as well as take care of the point in the constructor:</p>

<pre><code class="language-php">namespace App\Orchid\Layouts;

use Illuminate\Support\Str;
use Orchid\Screen\Field;
use Orchid\Screen\Fields\Input;
use Orchid\Screen\Layouts\Rows;

class AddressLayout extends Rows
{
    /**
     * Used to create the title of a group of form elements.
     *
     * @var string|null
     */
    protected $title;

    /**
     * Prefix for a field name
     *
     * @var string
     */
    protected $prefix;

    /**
     * ReusableEditLayout constructor.
     *
     * @param string      $prefix
     * @param string|null $title
     */
    public function __construct(string $prefix, string $title = null)
    {
        $this-&gt;prefix = Str::finish($prefix, '.');
        $this-&gt;title = $title;
    }

    /**
     * Get the fields elements to be displayed.
     *
     * @return Field[]
     */
    protected function fields(): array
    {
        return $this-&gt;addPrefix([
            Input::make('address')
                -&gt;required()
                -&gt;title('Address')
                -&gt;placeholder('177A Bleecker Street'),
        ]);
    }

    /**
     * @param Field[] $fields
     *
     * @return array
     */
    protected function addPrefix(array $fields): array
    {
        return array_map(function (Field $field) {
            return $field-&gt;set('name',
                $this-&gt;prefix . $field-&gt;get('name')
            );
        }, $fields);
    }
}
</code></pre>

<p>The main task has been solved. Now, the reuse of a class with one set of fields for the address does not make you think and duplicate it.</p>
            ]]></content>
        </entry>
    </feed>
